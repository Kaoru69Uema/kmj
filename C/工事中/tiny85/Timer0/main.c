/*===========================================================*/
/*   ファイル分割                                            */
/*                                                           */
/*   上間つよし＠沖縄県西原町＠久米島出身                    */
/*                                                           */
/*   令和4年11月1日（2022年11月1日）                         */
/*===========================================================*/

/*===========================================================*/
/*   プログラムコード開始                                    */
/*===========================================================*/

/*===========================================================*/
/*   インクルードファイル                                    */
/*===========================================================*/

#include <avr/io.h>
#include "timer0.h"
#include "soft_timer.h"
#include "sw.h"

/*===========================================================*/
/*   グローバル変数など　                                    */
/*===========================================================*/

volatile unsigned char f_1ms;
#define LED_A   PB0
#define LED_B   PB1
#define SW      PB4

/*===========================================================*/
/*   プロトタイプ宣言　　                                    */
/*===========================================================*/

int main( void );
void initialize( void );

int main( void )
{
	t0_ini();    /* timer0 初期化 */
	t_ini();     /* soft_timer 初期化 */

	while( 1 ) {
		t_main();
		sw_main();

		if( sw_dn & ( 1 << SW ) ) {
			PORTB |= 1 << LED_A;
		}

		if( sw_up & ( 1 << SW ) ) {
			PORTB &= ~(1 << LED_A);
			t_req( 0 );   /* ５秒後LED_Bを点灯 */
		}

		if( t_tup( 0 ) ) {
			t_can( 0 );   /* タイマーキャンセル */
			t_req( 1 );   /* ３秒後LED_Bを消灯 */
			PORTB |= 1 << LED_B;
		}

		if( t_tup( 1 ) ) {
			t_can( 1 );   /* タイマーキャンセル */
			PORTB &= ~(1 << LED_B);
		}

		while( ! f_1ms ) ;
		f_1ms = 0;
	}

	return 0;
}

void initialize( void )
{
	DDRB = (1 << LED_A ) | ( 1 << LED_B );
}


/*===========================================================*/
/*   プログラムコード終了                                    */
/*===========================================================*/

